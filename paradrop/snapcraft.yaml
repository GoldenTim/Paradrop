name: paradrop-daemon
version: '0.3.0'
summary: The ParaDrop daemon running at the extreme edge
description: |
  The ParaDrop deamon manages resources in the Wi-Fi routers and provides a virtualized environment for chutes.
  It also expose local environment information for chutes.

grade: devel
confinement: devmode

apps:
  paradrop:
    command: runpd.sh
    daemon: simple
    plugs:
      - network
      - docker

parts:
  glue:
    plugin: dump
    source: wrapper/
    organize:
      runpd.sh: bin/runpd.sh
      env.sh: bin/env.sh

  localweb:
    plugin: dump
    source: localweb/

  paradrop:
    plugin: python
    python-version: python2
    source: src
    build-packages:
      - python-dev
    stage-packages:
      - libcurl4-openssl-dev
      - python-openssl

  pipework:
    plugin: dump
    source: https://github.com/jpetazzo/pipework
    source-type: git
    organize:
      pipework: usr/bin/pipework
    snap:
      - usr/bin/pipework

  dnsmasq:
    plugin: make
    source: https://git.launchpad.net/~snappy-hwe-team/snappy-hwe-snaps/+git/wifi-ap
    source-type: git
    source-branch: dnsmasq/2.75
    build-packages:
      - build-essential
    make-parameters:
      - PREFIX=/
    organize:
      sbin/dnsmasq: bin/dnsmasq
    filesets:
      binaries:
        - bin/dnsmasq
    snap:
      - $binaries

  hostapd:
    plugin: make
    source: https://git.launchpad.net/~snappy-hwe-team/snappy-hwe-snaps/+git/wifi-ap
    source-type: git
    source-branch: hostapd/2.5
    build-packages:
      - build-essential
      - pkg-config
      - libnl-3-dev
      - libnl-genl-3-dev
      - libnl-route-3-dev
      - libssl-dev
    make-parameters:
      - BINDIR=/bin
    filesets:
      binaries:
        - bin/hostapd
        - bin/hostapd_cli
    snap:
      - $binaries
